language: c

dist: bionic
addons:
  apt:
    packages:
      - "python3"
      - "python3-pip"
      - "python3-setuptools"
      - "docker.io"
before_script:
  - sudo apt-get update
  - sudo apt-get install build-essential
  - sudo apt-get install clang-7
  - sudo apt-get install llvm-7
  - sudo apt-get install libelf-dev
  - sudo apt-get install libcmocka-dev
  - sudo apt-get install lcov
  - pip3 install --upgrade pip
  - sudo pip3 install setuptools netaddr docker grpcio-tools kubernetes
  - sudo systemctl unmask docker.service
  - sudo systemctl unmask docker.socket
  - sudo systemctl start docker
  - sudo systemctl enable docker
  # Install Kind
  - curl -Lo kind https://github.com/kubernetes-sigs/kind/releases/download/v0.9.0/kind-linux-amd64 && chmod +x kind && sudo mv kind /usr/local/bin/
  # Install Kubectl
  - curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl && chmod +x kubectl && sudo mv kubectl /usr/local/bin/
jobs:
  include:
    - stage: "Compile & test"
      script: make && make run_unittests && make e2efunctest
