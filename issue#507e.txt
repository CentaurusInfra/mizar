#!/bin/bash
kernel_ver=`uname -r`
kernel_hed=`sudo apt search linux-headers-$(uname -r)`

echo "Running kernel version: $kernel_ver"
echo "..................................."
echo "Running kernel headers: $kernel_hed"

mj_ver=$(echo $kernel_ver | cut -d. -f1)
mn_ver=$(echo $kernel_ver | cut -d. -f2)
mj_hed=$(echo $kernel_hed | cut -d. -f7 | cut -d- -f3)
mn_hed=$(echo $kernel_hed | cut -d. -f8)

a=0
mj_hed1=$a$mj_hed
mj_ver1=$a$mj_ver

if ([[ "$mj_ver1" -le "04" ]] || [[ "$mn_ver" -le "05" ]]) || ([[ "$mn_ver" -le "5" ]]); then
    tput setaf 1
    echo "Mizar requires an updated kernel: linux-5.6 rc2 for TCP to function correctly. Current version is $kernel_ver"
    read -p "Execute kernel update script (y/n)?" choice
    tput sgr0
    case "$choice" in
      y|Y ) sh ./kernelupdate.sh;;
      n|N ) echo "Please run kernelupdate.sh to download and update the kernel!"; exit;;
      * ) echo "Please run kernelupdate.sh to download and update the kernel!"; 
 exit;;
    esac
elif
   [[ "$mj_ver1" != "$mj_hed1" ]] || [[ "$mn_ver" != "$mn_hed" ]]; then
    tput setf 2
    echo " Update kernel_header..!! "
    read -p "Execute kernel_header update command (y/n)?" choice
    tput sgr0
    case "$choice" in
      y|Y ) echo `sudo apt-get install linux-headers-$(uname -r)`;;
      n|N ) echo "Please run kernelheader to download and update
 the kernel_header!"; exit;;
      * ) echo "Please run kernelheader to download and update 
 the kernel_header!"; exit;;
    esac
fi
