## OVS直接路径

### 直接路径概念

直接路径使端点在其托管结点间之间进行通信，而无需通过网关，避免了由于流量通过多跳网关导致的转发延迟。

![avatar](https://github.com/zhangml/markdownImages/blob/master/gateway.png?raw=true)

### 如何建立VXLAN隧道

网关结点的控制层可以使用RESTCONF/NETCONF等协议在主机OVS侧配置VTEP隧道端点。每台主机上的OVS可配置多条隧道，每条对应该主机到一个结点（另一个主机或所属的网关）的隧道路径。

### 下发流表

网关结点的控制层使用openflow协议下发流表至OVS，流表可以控制流通过指定的隧道端口进行转发。

### 在每个主机OVS维护的信息

1. VXLAN隧道端点（VTEP）配置。
2. OVS流表。（规模最大不会超过该主机上端点的数量）。

### 流程示意

1. 所有主机在上线时，可以由所属的网关结点的控制层配置主机到网关的一条VXLAN隧道，同时使用openflow协议在主机侧下发一条优先级最低的默认流表，该流表的作用是将主机上不匹配其它表项的流全部通过该主机到网关结点的VXLAN隧道转发至网关结点。

2. 虚机上线后第一个包会匹配主机上优先级最低的默认表项，转发至网关结点，网关结点查询全局的表项进行转发。网关结点收到数据包后，将会在通信的虚机对所在的主机对间建立一条VXLAN隧道，同时在该主机对下发流表。后续的数据包由于匹配之前下发的流表项，可以直接通过主机到主机间的VXLAN隧道转发，无需经过网关结点的中继转发。







